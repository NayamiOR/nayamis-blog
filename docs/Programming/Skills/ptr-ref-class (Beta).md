# 指针、引用和类导论（Beta版）

## 介绍和目标

指针和引用是 C 和 Java 中使用的两种内存管理方式，二者的作用类似。而结构体和类也是这两种语言中管理数据结构的方式。这次我想结合这些知识点让你快速了解类和引用对象，为面向对象打基础（同时为力扣刷题提供前置知识）。

这个教程面向的是翻来覆去无法理解概念的同学，所以在这里我会用尽量通俗的说法来让你快速理解这些概念，以及他们的本质。放弃完全的严谨，只求高效的理解。背概念没有意义，理解才能举一反三。

## 内存、堆和栈

首先我想简单介绍下内存。通俗的理解来说，内存就是计算机中连续的一长条空间，用来存储临时数据。

内存包含一长串存储单元，一个单元的空间是一字节。每个单元可以存储一个值，同时每个位置对应了一个地址。

在我们聊到在内存中存储数据时，我们会经常提到两个概念，就是堆（heap）和栈（stack）。在栈上的数据可以直接访问，但堆上的数据只能另想办法间接访问。

把东西在栈上存取效率很高且简单，但它有一个限制，就是编译时，存储的数据的大小必须是确定的。一般来说像整数变量这种东西都可以存在栈上，但有些时候因为一些面向对象的原因，我们要存的数据无法在编译时确定大小，就只能在堆上存储数据。

为了能快速找到放在堆上的数据，我们把它在堆上的地址记录下来，放到栈里，从而能在要用的时候用这个地址找到对应的数据，这就是间接访问。因此，堆可以灵活分配无限制的大小，灵活性很强，但为此付出了额外的性能开销和牺牲了额外的访问速度。

到这里你可能晕了，不要担心，这里你只需要记住，内存分堆、栈。确定大小放栈上，不确定大小放堆上。栈快，堆慢。记不住也没关系，入门的时候这些知识不是必须的，但只要能理解就是赚到。

## 结构体和类

结构体在 C 中被用来把多个变量，一起打包存储到同一个结构（变量）里作为一个整体。

比如假设要存储一个网站用户信息的数据，那么每一个用户都有几个不同的信息，比如年龄、编号、性别、等级等数据。这些数据都属于同一个用户，那最好的方法肯定就是放在同一个结构体里，每一个结构体对应一个用户的信息。每一条数据都叫做结构体的一个成员。

在从面向过程进化到面向对象的过程中，类是和结构体类似的概念，上面讲的结构体的功能，类都有。而且一个类上还可以绑定函数（方法）作为成员，可以像调用成员一样调用成员函数。此外类相比结构体会有很多额外的面向对象的用法，但这里不赘述。

总之你可以把类暂时理解为结构体的升级，同时内部可以存储函数作为成员。

## 指针和引用类型

很多语言中的类型主要可以分为两种：

1. 值类型
2. 引用类型

为了方便理解，值类型就是类似数字、布尔值这样，内存中直接存储着数据的值，大小固定，存在栈上。相比之下，引用类型在内存中并不直接存储值，因为大小可能不固定，所以通常存在堆上。

对于值类型，我们可以直接访问并使用存储的值，但对于引用类型，我们其实是通过存储指向堆上数据的指针来访问它的。只是这样的操作细节在实际编程中往往隐藏在代码背后。

所以说其实引用类型就像是自带指针的数据，这就是爪哇在放弃指针的前提下管理内存的方式。按照这个逻辑，你可以粗略的把类当成一个指向结构体的指针。

## 值传递和引用传递

刚才我们提到类型分值类型和引用类型，同理，在函数中也可以分值传递和引用传递。

我们还是把变量比喻成抽屉，每个抽屉有一个地址和存储的值。所谓值传递就是把这个抽屉的值传递给函数，而引用传递则是把这个抽屉的地址告诉函数。值类型一般使用值传递，而引用类型一般使用引用传递。同理，在没有引用类型概念的语言中，引用传递就相当于传递变量的指针，因为指针本身代表着变量的地址。

值传递适用于只需要变量的值的场景，比如一个求和函数，只需要参数的值就能求和。引用传递则适用于要修改参数本身的值的情况，此外也可以用来避免值传递的性能问题，或者利用修改外部变量来实现多返回值的效果。总之，如果你需要在函数内修改外部变量，那你就需要用到引用传递。